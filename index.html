<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é¦™æ¸¯è¡Œæ¥­é˜²è¡›æˆ°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        :root {
            --app-height: 100dvh;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            height: var(--app-height);
            overflow: hidden;
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a;
            color: white;
            touch-action: none;
            display: flex;
            flex-direction: column;
        }

        #gameContainer {
            position: relative;
            flex: 1;
            width: 100%;
            overflow: hidden;
            background: radial-gradient(circle at bottom center, #1e293b, #0f172a);
        }
        
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            100% { transform: translate(0, 0) rotate(0); }
        }
        
        .shake {
            animation: shake 0.5s;
            animation-iteration-count: 1;
        }

        .damage-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 0, 0, 0.3);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 5;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        /* Shop Area */
        #shopPanel {
            height: 120px;
            width: 100%;
            background-color: #0f172a;
            border-top: 2px solid #334155;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            padding: 8px;
            padding-bottom: env(safe-area-inset-bottom, 8px);
            flex-shrink: 0;
            z-index: 20;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        .shop-btn {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #94a3b8;
            transition: all 0.1s;
            user-select: none;
            position: relative;
            overflow: hidden;
            padding: 2px;
            -webkit-tap-highlight-color: transparent;
        }

        .shop-btn:active { transform: scale(0.96); }

        .shop-btn.affordable {
            background: linear-gradient(135deg, #b91c1c, #ef4444); 
            color: white;
            border-color: #fca5a5;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.4);
        }

        .shop-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #0f172a;
        }

        .shop-icon { font-size: clamp(1rem, 4vw, 1.4rem); line-height: 1.2; margin-bottom: 2px; }
        .shop-info { font-size: clamp(0.6rem, 3vw, 0.8rem); font-weight: bold; line-height: 1.1; text-align: center; }
        .shop-cost { font-size: clamp(0.6rem, 3vw, 0.75rem); color: #fbbf24; font-weight: bold; }

        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: rgba(0, 0, 0, 0.95);
            z-index: 50;
            backdrop-filter: blur(8px);
            padding: 20px;
        }

        .hidden { display: none !important; }

        .btn-main {
            background: linear-gradient(45deg, #dc2626, #991b1b);
            border: none;
            padding: 15px 40px;
            color: white;
            font-size: 1.4rem;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(220, 38, 38, 0.6);
            margin-top: 20px;
            transition: transform 0.1s;
            text-transform: uppercase;
            letter-spacing: 2px;
            white-space: nowrap;
        }
        .btn-main:active { transform: scale(0.95); }

        #hud {
            position: absolute;
            top: env(safe-area-inset-top, 10px);
            left: 10px; right: 10px;
            display: flex; justify-content: space-between;
            pointer-events: none;
            z-index: 10;
            font-size: clamp(1rem, 4vw, 1.4rem);
            font-weight: bold;
            text-shadow: 2px 2px 2px rgba(0,0,0,0.8);
        }

        .gold-display { color: #fbbf24; }
        .wave-display { color: #f87171; }
        .lives-display { color: #f43f5e; }
        
        .wave-notification {
            position: absolute;
            top: 40%; width: 100%; text-align: center;
            font-size: clamp(3rem, 10vw, 5rem);
            font-weight: 900;
            color: #ef4444;
            text-shadow: 0 0 20px rgba(0,0,0,0.8);
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
            z-index: 30;
            letter-spacing: 5px;
        }

        /* Quiz Styles - Modified for Long Text */
        .quiz-container {
            width: 95%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .quiz-btn {
            background: white; color: #1e293b;
            width: 100%; padding: 12px; margin: 6px 0;
            border-radius: 8px; font-size: 1rem; font-weight: bold;
            text-align: left; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            cursor: pointer;
            white-space: normal; /* Allow text wrap */
            line-height: 1.4;
        }
        .quiz-btn:active { transform: scale(0.98); background: #f1f5f9; }

        .damage-text {
            position: absolute; color: #fff; font-weight: bold;
            pointer-events: none; animation: floatUp 0.8s ease-out forwards;
            font-size: 20px; z-index: 5;
            text-shadow: 0 0 5px #ff0000, 1px 1px 0 #000;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-40px) scale(1.2); }
        }
    </style>
</head>
<body>

    <!-- Game Area -->
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="damageOverlay" class="damage-overlay"></div>
        
        <!-- HUD -->
        <div id="hud">
            <div>
                <div class="lives-display">â¤ï¸ <span id="livesVal">5</span></div>
                <div class="wave-display text-sm">WAVE <span id="waveVal">1</span>/20</div>
            </div>
            <div class="gold-display text-right">ğŸ’° <span id="goldVal">0</span></div>
        </div>
        
        <!-- Wave Notification -->
        <div id="waveNotify" class="wave-notification">WAVE 1</div>

        <!-- Start Screen -->
        <div id="startScreen" class="overlay">
            <h1 class="text-4xl md:text-5xl font-black mb-4 text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-orange-500 text-center">é¦™æ¸¯è¡Œæ¥­é˜²è¡›æˆ°</h1>
            <div class="bg-black/60 p-6 rounded-lg text-center backdrop-blur-sm border border-red-900 w-full max-w-md">
                <p class="text-gray-300 mb-2 font-bold text-lg">âš ï¸ ä»»å‹™ç›®æ¨™</p>
                <ul class="text-left text-sm text-gray-400 space-y-2 mb-6 list-disc pl-5">
                    <li>ä½ æœ‰ <span class="text-red-400 font-bold">5 é¡†ç”Ÿå‘½</span></li>
                    <li>ç”Ÿå­˜ç›´åˆ° <span class="text-yellow-400 font-bold">ç¬¬ 20 æ³¢</span> çµæŸ</li>
                    <li>å›ç­”<span class="text-green-400 font-bold">é¦™æ¸¯å¸¸è­˜</span>è³ºéŒ¢å‡ç´š</li>
                    <li>æ€ªç‰©æœƒéš¨æ™‚é–“æŒ‡æ•¸ç´šè®Šå¼·</li>
                </ul>
                <button class="btn-main" onclick="startGame()">é–‹å§‹é˜²å®ˆ</button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" class="overlay hidden">
            <div class="bg-slate-800 p-6 rounded-xl border border-red-500/30 w-full max-w-2xl text-center shadow-2xl shadow-red-900/20 quiz-container">
                <h2 class="text-2xl font-bold mb-1 text-yellow-400">æ³¢æ•¸å®Œæˆï¼</h2>
                <div class="text-green-400 text-lg font-bold mb-4">ç­”å°çå‹µ: $<span id="quizRewardVal">0</span></div>
                
                <div id="questionText" class="text-xl md:text-2xl font-bold mb-6 text-white text-left leading-relaxed border-b border-slate-600 pb-4">
                    é¡Œç›®è¼‰å…¥ä¸­...
                </div>
                
                <div id="answerOptions" class="flex flex-col w-full"></div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="overlay hidden">
            <h1 class="text-6xl font-black mb-4 text-red-600 tracking-widest text-center">æ•—åŒ—</h1>
            <p class="text-2xl mb-8">å­˜æ´»æ³¢æ•¸: <span id="finalWave">0</span></p>
            <button class="btn-main" onclick="resetGame()">å†è©¦ä¸€æ¬¡</button>
        </div>

        <!-- Victory Screen -->
        <div id="victoryScreen" class="overlay hidden">
            <h1 class="text-5xl md:text-6xl font-black mb-4 text-yellow-400 tracking-widest text-center drop-shadow-[0_0_15px_rgba(250,204,21,0.8)]">ä»»å‹™å®Œæˆ!</h1>
            <div class="text-center mb-8">
                <p class="text-2xl text-white mb-2">ä½ æˆåŠŸå®ˆä½äº† 20 æ³¢æ”»æ“Š</p>
                <p class="text-xl text-gray-300">é¦™æ¸¯å¸¸è­˜å¤§å¸«ï¼Œç•¶ä¹‹ç„¡æ„§ï¼</p>
            </div>
            <button class="btn-main bg-gradient-to-r from-yellow-500 to-orange-500 border-yellow-300" onclick="resetGame()">å†æ¬¡æŒ‘æˆ°</button>
        </div>
    </div>

    <!-- Persistent Shop Panel -->
    <div id="shopPanel">
        <!-- Multishot -->
        <button class="shop-btn" id="btn-count" onclick="buyUpgrade('count')">
            <div class="shop-icon">ğŸ¹ x<span id="val-count">1</span></div>
            <div class="shop-info">æ•¸é‡</div>
            <div class="shop-cost">$<span id="cost-count">100</span></div>
        </button>

        <!-- Speed -->
        <button class="shop-btn" id="btn-speed" onclick="buyUpgrade('speed')">
            <div class="shop-icon">âš¡ <span id="val-speed">1</span></div>
            <div class="shop-info">é€Ÿåº¦</div>
            <div class="shop-cost">$<span id="cost-speed">50</span></div>
        </button>

        <!-- Power -->
        <button class="shop-btn" id="btn-power" onclick="buyUpgrade('power')">
            <div class="shop-icon">ğŸ’ª <span id="val-power">10</span></div>
            <div class="shop-info">åŠ›é‡</div>
            <div class="shop-cost">$<span id="cost-power">80</span></div>
        </button>

        <!-- Pierce -->
        <button class="shop-btn" id="btn-pierce" onclick="buyUpgrade('pierce')">
            <div class="shop-icon">ğŸ”© <span id="val-pierce">1</span></div>
            <div class="shop-info">ç©¿é€</div>
            <div class="shop-cost">$<span id="cost-pierce">200</span></div>
        </button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameContainer = document.getElementById('gameContainer');
        const damageOverlay = document.getElementById('damageOverlay');

        // --- Quiz Data (GS_industry.md) ---
        const quizData = [
            {
                q: "1. é¦™æ¸¯æœ‰å››å¤§ä¸»è¦è¡Œæ¥­é¡åˆ¥ï¼Œä»¥ä¸‹å“ªä¸€é … ä¸æ˜¯ å…¶ä¸­ä¹‹ä¸€ï¼Ÿ<br>Which of the following is NOT one of the four key industries in Hong Kong?",
                options: [
                    "A. é‡‘èæœå‹™æ¥­ (Financial Services)", 
                    "B. æ—…éŠæ¥­ (Tourism)", 
                    "C. è¾²æ¥­åŠæ¼æ¥­ (Agriculture and Fisheries)", 
                    "D. è²¿æ˜“åŠç‰©æµæ¥­ (Trading and Logistics)"
                ],
                ans: 2 // C
            },
            {
                q: "2. ç”±æ–¼é¦™æ¸¯ç¼ºä¹å¤©ç„¶è³‡æºï¼Œå¤§éƒ¨ä»½é£Ÿå“å’Œæ—¥ç”¨å“éƒ½éœ€è¦ä¾é ç”šéº¼é€”å¾‘ç²å¾—ï¼Ÿ<br>Since Hong Kong lacks natural resources, how do we obtain most food and daily necessities?",
                options: [
                    "A. æœ¬åœ°ç”Ÿç”¢ (Local Production)", 
                    "B. é€²å£ (Import)", 
                    "C. å‡ºå£ (Export)", 
                    "D. è½‰å£ (Re-export)"
                ],
                ans: 1 // B
            },
            {
                q: "3. æ ¹æ“š2016å¹´çš„çµ±è¨ˆåœ–è¡¨ï¼Œé¦™æ¸¯å“ªä¸€å€‹è¡Œæ¥­é¡åˆ¥çš„å°±æ¥­äººæ•¸æœ€å¤šï¼Ÿ<br>According to the 2016 statistics chart, which industry had the highest number of employees?",
                options: [
                    "A. é‡‘èæœå‹™æ¥­ (Financial Services)", 
                    "B. æ—…éŠæ¥­ (Tourism)", 
                    "C. è²¿æ˜“åŠç‰©æµæ¥­ (Trading and Logistics)", 
                    "D. å°ˆæ¥­åŠå·¥å•†æ¥­æ”¯æ´æœå‹™æ¥­ (Professional and Business Support Services)"
                ],
                ans: 2 // C
            },
            {
                q: "4. æ—…å®¢ä¾†é¦™æ¸¯æ—…éŠï¼Œæœƒå¸¶å‹•å¤šå€‹è¡Œæ¥­çš„ç™¼å±•ã€‚ä»¥ä¸‹å“ªä¸€å€‹è¡Œæ¥­å—æƒ æœ€å°‘ï¼Ÿ<br>Tourists visiting Hong Kong drive the development of many industries. Which of the following benefits the LEAST?",
                options: [
                    "A. é›¶å”®æ¥­ (Retail)", 
                    "B. é£²é£Ÿæ¥­ (Catering)", 
                    "C. é…’åº—æ¥­ (Hotel)", 
                    "D. é‡å·¥æ¥­ (Heavy Industry)"
                ],
                ans: 3 // D
            },
            {
                q: "5. é¦™æ¸¯æœ€å¤§çš„è²¿æ˜“å¤¥ä¼´æ˜¯å“ªä¸€å€‹åœ°å€ï¼Ÿ<br>Which region is Hong Kong's largest trading partner?",
                options: [
                    "A. ç¾åœ‹ (USA)", 
                    "B. ä¸­åœ‹å…§åœ° (Mainland China)", 
                    "C. æ—¥æœ¬ (Japan)", 
                    "D. æ–°åŠ å¡ (Singapore)"
                ],
                ans: 1 // B
            },
            {
                q: "6. ç‰©æµæ¥­çš„å·¥ä½œæµç¨‹åŒ…æ‹¬å€‰å‹™ç®¡ç†ã€è²¨å­˜ç®¡ç†ã€åŒ…è£å’Œè²¼æ¨™ç±¤ç­‰ï¼Œä½† ä¸åŒ…æ‹¬ ä»¥ä¸‹å“ªä¸€é …ï¼Ÿ<br>Logistics processes include warehousing, inventory management, packaging, and labeling, but do NOT include which of the following?",
                options: [
                    "A. é‹é€è²¨å“ (Transporting goods)", 
                    "B. ç”Ÿç”¢è²¨ç‰© (Manufacturing goods)", 
                    "C. åŒ…è£è²¨å“ (Packaging goods)", 
                    "D. å€‰å‹™ç®¡ç† (Warehousing management)"
                ],
                ans: 1 // B
            },
            {
                q: "7. ã€Œè½‰å£è²¿æ˜“ã€æ˜¯æŒ‡ç”šéº¼ï¼Ÿ<br>What does \"Re-export trade\" mean?",
                options: [
                    "A. æŠŠé¦™æ¸¯è£½é€ çš„ç”¢å“è³£åˆ°å¤–åœ‹ (Selling products made in HK to foreign countries)", 
                    "B. æŠŠå¤–åœ‹è²¨å“é‹å…¥é¦™æ¸¯è‡ªç”¨ (Importing foreign goods for local use)", 
                    "C. æŠŠå¤–åœ‹è²¨å“é‹å…¥é¦™æ¸¯ï¼Œå†è½‰è³£åˆ°å…¶ä»–åœ°æ–¹ (Importing goods into HK and then reselling them to other places)", 
                    "D. è³¼è²·é¦™æ¸¯æœ¬åœ°çš„è¾²ç”¢å“ (Buying local agricultural products)"
                ],
                ans: 2 // C
            },
            {
                q: "8. æ”¿åºœç©æ¥µæ¨å‹•æ–°èˆˆè¡Œæ¥­ã€‚è‹¥æƒ³æˆç‚ºã€Œæ‰‹æ©Ÿç¨‹å¼é–‹ç™¼å“¡ã€ï¼Œä¸»è¦éœ€è¦å“ªæ–¹é¢çš„èƒ½åŠ›ï¼Ÿ<br>The government promotes new industries. To become a \"Mobile App Developer\", what key skill is required?",
                options: [
                    "A. ç†Ÿæ‚‰ç·¨å¯«ç¨‹å¼ (Familiarity with coding/programming)", 
                    "B. æŒæœ‰ç”Ÿç‰©é†«å­¸è­‰æ›¸ (Holding a biomedical certificate)", 
                    "C. æ‡‚å¾—é§•é§›é£›æ©Ÿ (Knowing how to fly a plane)", 
                    "D. æ“…é•·å°éŠè§£èªª (Good at tour guiding)"
                ],
                ans: 0 // A
            },
            {
                q: "9. é¦™æ¸¯ç‰©æµæ¥­é¢å°ç”šéº¼æŒ‘æˆ°ï¼Ÿ<br>What challenges does Hong Kong's logistics industry face?",
                options: [
                    "A. ç”¨åœ°ä¸è¶³ (Insufficient land)", 
                    "B. äººæ‰‹çŸ­ç¼º (Labor shortage)", 
                    "C. é„°è¿‘åœ°å€ç«¶çˆ­æ¿€çƒˆ (Intense competition from neighboring regions)", 
                    "D. ä»¥ä¸Šçš†æ˜¯ (All of the above)"
                ],
                ans: 3 // D
            },
            {
                q: "10. ç‚ºäº†è§£æ±ºç‰©æµæ¥­äººæ‰‹çŸ­ç¼ºçš„å•é¡Œï¼Œæ¥­ç•Œæ¡å–äº†ç”šéº¼æªæ–½ï¼Ÿ<br>To solve the labor shortage in logistics, what measure has the industry adopted?",
                options: [
                    "A. åœæ­¢é‹ä½œ (Cease operations)", 
                    "B. æ‡‰ç”¨ç§‘æŠ€ï¼Œæ¨å‹•è‡ªå‹•åŒ– (Apply technology and promote automation)", 
                    "C. æ¸›å°‘é€²å£è²¨å“ (Reduce imported goods)", 
                    "D. å¢åŠ äººæ‰‹æ¬é‹ (Increase manual labor)"
                ],
                ans: 1 // B
            },
            {
                q: "11. é€£æ¥é¦™æ¸¯ã€ç æµ·å’Œæ¾³é–€çš„è·¨æµ·é€šé“å«ç”šéº¼ï¼Ÿ<br>What is the name of the cross-sea crossing connecting Hong Kong, Zhuhai, and Macao?",
                options: [
                    "A. é’é¦¬å¤§æ©‹ (Tsing Ma Bridge)", 
                    "B. æ¸¯ç æ¾³å¤§æ©‹ (Hong Kong-Zhuhai-Macao Bridge)", 
                    "C. æ·±åœ³ç£å¤§æ©‹ (Shenzhen Bay Bridge)", 
                    "D. æ±€ä¹æ©‹ (Ting Kau Bridge)"
                ],
                ans: 1 // B
            },
            {
                q: "12. ä»¥ä¸‹å“ªä¸€é …å±¬æ–¼ã€Œé‡‘èæœå‹™æ¥­ã€çš„ç¯„ç–‡ï¼Ÿ<br>Which of the following falls under \"Financial Services\"?",
                options: [
                    "A. å¤–åŒ¯è²·è³£ (Foreign exchange trading)", 
                    "B. è²¨ç‰©é‹è¼¸ (Cargo transport)", 
                    "C. å°éŠæœå‹™ (Tour guide services)", 
                    "D. å»ºç¯‰è¨­è¨ˆ (Architectural design)"
                ],
                ans: 0 // A
            },
            {
                q: "13. å»£æ·±æ¸¯é«˜é€Ÿéµè·¯ï¼ˆé¦™æ¸¯æ®µï¼‰çš„è»Šç«™ä½æ–¼å“ªè£¡ï¼Ÿ<br>Where is the station for the Guangzhou-Shenzhen-Hong Kong Express Rail Link (Hong Kong Section) located?",
                options: [
                    "A. ç¾…æ¹– (Lo Wu)", 
                    "B. ç´…ç£¡ (Hung Hom)", 
                    "C. è¥¿ä¹é¾ (West Kowloon)", 
                    "D. æ©Ÿå ´ (Airport)"
                ],
                ans: 2 // C
            },
            {
                q: "14. åœ¨é¦™æ¸¯èˆ‡ä¸­åœ‹å…§åœ°çš„ç¶“æ¿Ÿåˆä½œä¸­ï¼Œé¦™æ¸¯ä¸»è¦æä¾›ç”šéº¼å„ªå‹¢ï¼Ÿ<br>In the economic cooperation between Hong Kong and Mainland China, what is the main advantage Hong Kong provides?",
                options: [
                    "A. å»‰åƒ¹åœŸåœ° (Cheap land)", 
                    "B. é¾å¤§çš„æ¶ˆè²»å¸‚å ´ (Huge consumer market)", 
                    "C. é‡‘èäººæ‰å’Œå°ˆæ¥­æœå‹™ (Financial talent and professional services)", 
                    "D. ç§‘ç ”é…å¥—è¨­æ–½ (Scientific research facilities)"
                ],
                ans: 2 // C
            },
            {
                q: "15. ç”šéº¼æ˜¯ã€Œå¤§ç£å€ã€ï¼Ÿ<br>What is the \"Greater Bay Area\"?",
                options: [
                    "A. é¦™æ¸¯å³¶çš„ä¸€å€‹æµ·ç£ (A bay on Hong Kong Island)", 
                    "B. åŒ…æ‹¬é¦™æ¸¯ã€æ¾³é–€åŠå»£æ±çœä¹å€‹åŸå¸‚çš„åŸå¸‚ç¾¤ (A city cluster comprising HK, Macao, and 9 cities in Guangdong)", 
                    "C. åªåŒ…æ‹¬é¦™æ¸¯å’Œæ·±åœ³çš„åˆä½œå€ (A cooperation zone including only HK and Shenzhen)", 
                    "D. äºæ´²çš„ä¸€å€‹é‡‘èä¸­å¿ƒ (A financial center in Asia)"
                ],
                ans: 1 // B
            },
            {
                q: "16. æ ¹æ“šèª²æ–‡ï¼Œè‹¥ä½ æƒ³å¾äº‹ã€Œç”Ÿç‰©é†«å­¸ç ”ç©¶åŠ©ç†ã€ï¼Œä½ éœ€è¦å…·å‚™ç”šéº¼å­¸æ­·ï¼Ÿ<br>According to the text, if you want to be a \"Biomedical Research Assistant\", what qualification do you need?",
                options: [
                    "A. æ—…éŠæ¥­è­‰æ›¸ (Tourism certificate)", 
                    "B. å°ˆæ¥­å·¥ç¨‹çŸ¥è­˜ (Professional engineering knowledge)", 
                    "C. ç”Ÿç‰©é†«å­¸èª²ç¨‹è­‰æ›¸æˆ–å­¸ä½ (Biomedical course certificate or degree)", 
                    "D. æœƒè¨ˆå¸«ç‰Œç…§ (Accountant license)"
                ],
                ans: 2 // C
            },
            {
                q: "17. å“ªä¸€å€‹è¡Œæ¥­æœƒæ¶‰åŠã€Œè²¨å­˜ç®¡ç†ã€å’Œã€ŒåŒ…è£è²¨å“ã€ï¼Ÿ<br>Which industry involves \"Inventory Management\" and \"Packaging Goods\"?",
                options: [
                    "A. é‡‘èæ¥­ (Financial Industry)", 
                    "B. ç‰©æµæ¥­ (Logistics Industry)", 
                    "C. æ—…éŠæ¥­ (Tourism Industry)", 
                    "D. æ•™è‚²æ¥­ (Education Industry)"
                ],
                ans: 1 // B
            },
            {
                q: "18. ä¸­åœ‹å…§åœ°ç‚ºé¦™æ¸¯çš„ç¶“æ¿Ÿç™¼å±•æä¾›äº†ç”šéº¼æ”¯æ´ï¼Ÿ<br>What support does Mainland China provide for Hong Kong's economic development?",
                options: [
                    "A. æä¾›ç§‘ç ”ç”Ÿç”¢åŸºåœ°å’Œé¾å¤§å¸‚å ´ (Provide research/production bases and a huge market)", 
                    "B. æä¾›åœ‹éš›é‡‘èæœå‹™ (Provide international financial services)", 
                    "C. æä¾›å°ˆæ¥­æ³•å¾‹æ„è¦‹ (Provide professional legal advice)", 
                    "D. æä¾›å¤–åŒ¯è²·è³£ (Provide foreign exchange trading)"
                ],
                ans: 0 // A
            },
            {
                q: "19. ä¸‹åœ–é¡¯ç¤ºçš„è·æ¥­ã€Œå°éŠã€å±¬æ–¼å“ªä¸€å€‹ä¸»è¦è¡Œæ¥­ï¼Ÿ<br>The job \"Tour Guide\" belongs to which major industry?",
                options: [
                    "A. å°ˆæ¥­æœå‹™æ¥­ (Professional Services)", 
                    "B. è²¿æ˜“åŠç‰©æµæ¥­ (Trading and Logistics)", 
                    "C. æ—…éŠæ¥­ (Tourism)", 
                    "D. é‡‘èæœå‹™æ¥­ (Financial Services)"
                ],
                ans: 2 // C
            },
            {
                q: "20. ç‚ºç”šéº¼é¦™æ¸¯è¢«ç¨±ç‚ºã€Œåœ‹éš›è²¿æ˜“ä¸­å¿ƒã€ï¼Ÿ<br>Why is Hong Kong known as an \"International Trade Center\"?",
                options: [
                    "A. å› ç‚ºé¦™æ¸¯åªå‡ºå£æœ¬åœ°ç”¢å“ (Because HK only exports local products)", 
                    "B. å› ç‚ºé¦™æ¸¯é€šéé€²å£ã€å‡ºå£å’Œè½‰å£èˆ‡ä¸–ç•Œå„åœ°é€²è¡Œé »ç¹è²¿æ˜“ (Because HK trades frequently with the world through imports, exports, and re-exports)", 
                    "C. å› ç‚ºé¦™æ¸¯æœ‰å¾ˆå¤šäººå»æ—…è¡Œ (Because many people travel to HK)", 
                    "D. å› ç‚ºé¦™æ¸¯æœ‰å¾ˆå¤šéŠ€è¡Œ (Because HK has many banks)"
                ],
                ans: 1 // B
            }
        ];

        // Game State
        let gameState = 'MENU'; 
        let lastTime = 0;
        let animationId = null; 
        let bossSpawned = false; 
        const MAX_WAVE = 20;

        // Scaling Factors
        let gameScale = 1;
        let speedScale = 1;

        // Player Stats
        const player = {
            x: 0, 
            y: 0, 
            angle: -Math.PI / 2,
            gold: 0,
            wave: 1,
            lives: 5,
            stats: {
                count: 1,
                speed: 14, 
                power: 10,
                fireRate: 350,
                pierce: 1
            },
            upgrades: {
                count: { level: 1, cost: 200, costMult: 2.5 },
                speed: { level: 1, cost: 80, costMult: 1.6 },
                power: { level: 1, cost: 100, costMult: 1.5 },
                pierce: { level: 1, cost: 300, costMult: 3.0 }
            }
        };

        // Entities
        let projectiles = [];
        let enemies = [];
        let particles = [];
        
        // Input & Aiming
        let targetX = 0;
        let targetY = 0;
        let isInputActive = false;
        let lastShotTime = 0;

        // Wave Logic
        let spawnTimer = 0;
        let spawnInterval = 1000;
        let enemiesToSpawn = 0;

        // Enemy Types
        const ENEMY_TYPES = {
            NORMAL: { id: 'normal', emoji: 'ğŸ‘¾', hpMult: 1.0, speedMult: 1.0, radius: 20, color: '#ef4444' },
            FAST:   { id: 'fast',   emoji: 'ğŸ¦‡', hpMult: 0.6, speedMult: 1.8, radius: 15, color: '#a855f7', zigzag: true }, 
            TANK:   { id: 'tank',   emoji: 'ğŸ‘¹', hpMult: 3.5, speedMult: 0.6, radius: 28, color: '#166534' }, 
            BOSS:   { id: 'boss',   emoji: 'ğŸ’€', hpMult: 15.0, speedMult: 0.35, radius: 50, color: '#000000' }
        };

        // --- Initialization & Resizing (Dynamic Scaling) ---
        function resize() {
            const rect = gameContainer.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // iPad / Mobile Adaption
            gameScale = Math.min(canvas.width / 390, 1.5); 
            if(gameScale < 0.8) gameScale = 0.8;

            // Height scaling for consistent gameplay across devices
            speedScale = canvas.height / 800;

            player.x = canvas.width / 2;
            player.y = canvas.height - (50 * gameScale);
            
            if (gameState === 'MENU') {
                targetX = player.x;
                targetY = 0;
            }
        }
        
        window.addEventListener('resize', resize);
        resize();

        // --- Input Handlers ---
        function updateAim(clientX, clientY) {
            const rect = canvas.getBoundingClientRect();
            targetX = clientX - rect.left;
            targetY = clientY - rect.top;
        }

        function calculateAngle() {
             const dx = targetX - player.x;
             const dy = targetY - player.y;
             player.angle = Math.atan2(dy, dx);
        }

        function inputStart(e) {
            if (gameState !== 'PLAYING') return;
            isInputActive = true;
            let cx = e.touches ? e.touches[0].clientX : e.clientX;
            let cy = e.touches ? e.touches[0].clientY : e.clientY;
            updateAim(cx, cy);
            calculateAngle();
            tryShoot(Date.now());
        }

        function inputMove(e) {
            if (gameState !== 'PLAYING') return;
            let cx = e.touches ? e.touches[0].clientX : e.clientX;
            let cy = e.touches ? e.touches[0].clientY : e.clientY;
            updateAim(cx, cy);
            calculateAngle();
        }

        function inputEnd() { isInputActive = false; }

        canvas.addEventListener('mousedown', inputStart);
        canvas.addEventListener('mousemove', inputMove);
        window.addEventListener('mouseup', inputEnd);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); inputStart(e); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); inputMove(e); }, {passive: false});
        window.addEventListener('touchend', inputEnd);

        // --- Game Loop Management ---
        function startGame() {
            player.gold = 0;
            player.wave = 1;
            player.lives = 5; 
            player.stats = { count: 1, speed: 14, power: 10, fireRate: 350, pierce: 1 };
            player.upgrades = {
                count: { level: 1, cost: 200, costMult: 2.5 },
                speed: { level: 1, cost: 80, costMult: 1.6 },
                power: { level: 1, cost: 100, costMult: 1.5 },
                pierce: { level: 1, cost: 300, costMult: 3.0 }
            };

            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('victoryScreen').classList.add('hidden');
            
            resize();
            startWave();
            updateShopUI(); 
            
            if (animationId) cancelAnimationFrame(animationId);
            lastTime = performance.now();
            animationId = requestAnimationFrame(loop);
        }

        function resetGame() { startGame(); }

        function startWave() {
            gameState = 'PLAYING';
            projectiles = [];
            enemies = []; 
            bossSpawned = false; 
            
            enemiesToSpawn = 6 + Math.floor(player.wave * 2.2);
            spawnInterval = Math.max(300, 1500 - (player.wave * 60)); 
            spawnTimer = 0; 
            
            const notify = document.getElementById('waveNotify');
            notify.innerText = `WAVE ${player.wave}`;
            notify.style.opacity = 1;
            setTimeout(() => notify.style.opacity = 0, 2000);

            spawnEnemy(true);
            enemiesToSpawn--;

            updateHUD();
        }

        function loop(timestamp) {
            if (!timestamp) timestamp = performance.now();
            const dt = timestamp - lastTime;
            lastTime = timestamp;

            if (gameState === 'PLAYING') {
                update(dt);
            }
            draw();
            
            if (gameState === 'PLAYING') {
                animationId = requestAnimationFrame(loop);
            } else {
                animationId = null;
            }
        }

        function update(dt) {
            if (dt > 100) return;
            const now = Date.now();

            if (isInputActive) tryShoot(now);

            // Spawning
            if (enemiesToSpawn > 0) {
                spawnTimer += dt;
                if (spawnTimer >= spawnInterval) {
                    spawnEnemy();
                    spawnTimer = 0;
                    enemiesToSpawn--;
                }
            } else if (enemies.length === 0) {
                gameState = 'QUIZ';
                showQuiz();
                return;
            }

            // Projectiles
            for (let i = projectiles.length - 1; i >= 0; i--) {
                const p = projectiles[i];
                p.x += Math.cos(p.angle) * p.speed;
                p.y += Math.sin(p.angle) * p.speed;

                if (p.x < -50 || p.x > canvas.width + 50 || p.y < -50 || p.y > canvas.height + 50) {
                    projectiles.splice(i, 1);
                }
            }

            // Enemies
            for (let i = enemies.length - 1; i >= 0; i--) {
                const e = enemies[i];
                e.y += e.speed;
                
                // Zigzag Logic
                if (e.zigzag) {
                    const amp = (2 + player.wave * 0.1) * gameScale;
                    e.x += Math.sin(e.y * 0.05) * amp;
                    if (e.x < e.radius) e.x = e.radius;
                    if (e.x > canvas.width - e.radius) e.x = canvas.width - e.radius;
                }

                if (e.y > player.y - e.radius) {
                    takeDamage();
                    enemies.splice(i, 1);
                    if (player.lives <= 0) {
                        gameOver();
                        return;
                    }
                    continue; 
                }

                for (let j = projectiles.length - 1; j >= 0; j--) {
                    const p = projectiles[j];
                    const dist = Math.hypot(p.x - e.x, p.y - e.y);
                    
                    if (dist < e.radius + (15 * gameScale) && !p.hitList.includes(e.id)) {
                        e.hp -= p.damage;
                        p.hitList.push(e.id);
                        p.pierce--;

                        spawnParticles(e.x, e.y, p.color);
                        showDamage(e.x, e.y, p.damage);

                        if (p.pierce <= 0) projectiles.splice(j, 1);

                        if (e.hp <= 0) {
                            enemies.splice(i, 1);
                            player.gold += 1; 
                            updateHUD();
                            break;
                        }
                    }
                }
            }

            // Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.life -= 0.1; 
                p.x += p.vx;
                p.y += p.vy;
                if (p.life <= 0) particles.splice(i, 1);
            }
        }

        function takeDamage() {
            player.lives--;
            updateHUD();
            
            gameContainer.classList.add('shake');
            damageOverlay.style.opacity = 1;
            setTimeout(() => {
                gameContainer.classList.remove('shake');
                damageOverlay.style.opacity = 0;
            }, 300);
        }

        function gameOver() {
            gameState = 'GAMEOVER';
            document.getElementById('finalWave').innerText = player.wave;
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }
        
        function victory() {
            gameState = 'VICTORY';
            document.getElementById('victoryScreen').classList.remove('hidden');
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Aim Line
            if (isInputActive) {
                ctx.beginPath();
                ctx.moveTo(player.x, player.y);
                ctx.lineTo(player.x + Math.cos(player.angle) * 1000, player.y + Math.sin(player.angle) * 1000);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            // Player Bow (Scaled)
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.rotate(player.angle); 
            ctx.scale(gameScale, gameScale); 
            
            ctx.shadowBlur = 10; ctx.shadowColor = '#60a5fa';
            ctx.beginPath(); 
            ctx.moveTo(0, 0); ctx.quadraticCurveTo(5, -15, 25, -20); ctx.quadraticCurveTo(35, -25, 10, -45);
            ctx.moveTo(0, 0); ctx.quadraticCurveTo(5, 15, 25, 20); ctx.quadraticCurveTo(35, 25, 10, 45);
            ctx.strokeStyle = '#e2e8f0'; ctx.lineWidth = 3; ctx.lineCap = 'round'; ctx.stroke();
            ctx.shadowBlur = 0; ctx.beginPath(); 
            ctx.moveTo(0, -8); ctx.lineTo(4, 0); ctx.lineTo(0, 8); ctx.fillStyle = '#fbbf24'; ctx.fill();
            ctx.beginPath(); 
            ctx.moveTo(10, -45); ctx.lineTo(-5, 0); ctx.lineTo(10, 45);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)'; ctx.lineWidth = 1; ctx.stroke();
            ctx.beginPath(); 
            ctx.moveTo(-5, 0); ctx.lineTo(25, 0); ctx.strokeStyle = getArrowColor(); ctx.lineWidth = 2; ctx.stroke();
            ctx.restore();

            // Projectiles
            projectiles.forEach(p => {
                ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.angle);
                ctx.beginPath(); ctx.arc(0, 0, p.radius, 0, Math.PI*2); ctx.fillStyle = p.color + '44'; ctx.fill();
                ctx.beginPath(); ctx.moveTo(-15, 0); ctx.lineTo(15, 0); ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();
                ctx.beginPath(); ctx.moveTo(15, 0); ctx.lineTo(5, -5); ctx.lineTo(5, 5); ctx.fillStyle = p.color; ctx.fill();
                ctx.restore();
            });

            // Enemies (Scaled)
            enemies.forEach(e => {
                ctx.save();
                
                // HP Bar
                const barWidth = 40 * gameScale;
                const barHeight = 6 * gameScale;
                const barOffset = (e.radius + 10 * gameScale);
                
                ctx.fillStyle = '#4b0000';
                ctx.fillRect(e.x - barWidth/2, e.y - barOffset, barWidth, barHeight);
                const hpPct = Math.max(0, e.hp / e.maxHp);
                ctx.fillStyle = hpPct > 0.5 ? '#22c55e' : (hpPct > 0.2 ? '#eab308' : '#ef4444');
                ctx.fillRect(e.x - barWidth/2, e.y - barOffset, barWidth * hpPct, barHeight);
                
                // Emoji (Scaled font)
                ctx.font = `${e.radius * 2}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = 'white';
                ctx.fillText(e.emoji, e.x, e.y);
                
                // Boss Indicator
                if (e.radius > (40 * gameScale)) {
                    ctx.strokeStyle = 'red';
                    ctx.lineWidth = 3 * gameScale;
                    ctx.shadowColor = 'red';
                    ctx.shadowBlur = 10;
                    ctx.beginPath();
                    ctx.arc(e.x, e.y, e.radius + 5, 0, Math.PI*2);
                    ctx.stroke();
                }

                ctx.restore();
            });

            // Particles
            particles.forEach(p => {
                ctx.fillStyle = p.color; ctx.globalAlpha = p.life;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();
                ctx.globalAlpha = 1.0;
            });
        }

        // --- Logic ---
        function tryShoot(now) {
            if (now - lastShotTime > player.stats.fireRate) {
                shoot();
                lastShotTime = now;
            }
        }

        function shoot() {
            const count = player.stats.count;
            const spread = 0.15; 
            let startAngle = player.angle;
            for (let i = 0; i < count; i++) {
                let currentAngle = startAngle;
                if (count > 1) currentAngle = startAngle - (spread * (count - 1) / 2) + (spread * i);
                projectiles.push({
                    x: player.x + Math.cos(currentAngle) * (30 * gameScale),
                    y: player.y + Math.sin(currentAngle) * (30 * gameScale),
                    angle: currentAngle,
                    speed: player.stats.speed * speedScale,
                    radius: 5 * gameScale,
                    color: getArrowColor(),
                    damage: player.stats.power,
                    pierce: player.stats.pierce,
                    hitList: []
                });
            }
        }

        function getArrowColor() {
            if (player.stats.pierce >= 3) return '#f43f5e'; 
            if (player.stats.pierce >= 2) return '#f59e0b'; 
            return '#3b82f6'; 
        }

        function spawnEnemy(forceVisible = false) {
            const safeWidth = Math.max(canvas.width, 300); 
            let type = null;

            if (!forceVisible && player.wave % 5 === 0 && !bossSpawned) {
                if (Math.random() < 0.2 || enemiesToSpawn <= 1) {
                    type = ENEMY_TYPES.BOSS;
                    bossSpawned = true;
                }
            }

            if (!type) {
                const rand = Math.random();
                if (rand < 0.5) type = ENEMY_TYPES.NORMAL;
                else if (rand < 0.8) type = ENEMY_TYPES.FAST;
                else type = ENEMY_TYPES.TANK;
            }

            const r = type.radius * gameScale;
            const x = Math.random() * (canvas.width - r * 2) + r;
            const startY = forceVisible ? 60 : -50;

            const baseHp = 15;
            const growthFactor = Math.pow(1.28, player.wave - 1);
            const hp = Math.floor(baseHp * type.hpMult * growthFactor);

            const speedGrowth = Math.min(3.0, (player.wave - 1) * 0.1);
            const speed = (0.5 + speedGrowth) * type.speedMult * speedScale;

            enemies.push({
                id: Math.random(),
                x: x,
                y: startY,
                radius: r,
                emoji: type.emoji,
                hp: hp,
                maxHp: hp,
                speed: speed,
                color: type.color,
                zigzag: type.zigzag || false
            });
        }

        function spawnParticles(x, y, color) {
            for (let i = 0; i < 4; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random() - 0.5) * 8, vy: (Math.random() - 0.5) * 8,
                    life: 1, 
                    size: (Math.random() * 3 + 1) * gameScale, 
                    color: color
                });
            }
        }

        function showDamage(x, y, dmg) {
            const el = document.createElement('div');
            el.className = 'damage-text';
            el.style.left = (x + gameContainer.offsetLeft) + 'px';
            el.style.top = (y + gameContainer.offsetTop) + 'px';
            el.innerText = `-${Math.floor(dmg)}`;
            gameContainer.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // --- Shop System ---
        function updateHUD() {
            document.getElementById('waveVal').innerText = player.wave;
            document.getElementById('goldVal').innerText = player.gold;
            document.getElementById('livesVal').innerText = player.lives;
            updateShopUI();
        }

        function updateShopUI() {
            const types = ['count', 'speed', 'power', 'pierce'];
            types.forEach(type => {
                const upg = player.upgrades[type];
                const btn = document.getElementById(`btn-${type}`);
                document.getElementById(`cost-${type}`).innerText = Math.floor(upg.cost);
                let valDisplay = player.stats[type];
                if (type === 'fireRate') valDisplay = 'MAX'; 
                document.getElementById(`val-${type}`).innerText = valDisplay;

                if (player.gold >= Math.floor(upg.cost)) {
                    btn.disabled = false; btn.classList.add('affordable');
                } else {
                    btn.disabled = true; btn.classList.remove('affordable');
                }
            });
        }

        function buyUpgrade(type) {
            const upg = player.upgrades[type];
            const cost = Math.floor(upg.cost);
            if (player.gold >= cost) {
                player.gold -= cost;
                upg.level++;
                upg.cost *= upg.costMult; 

                if (type === 'count') player.stats.count++;
                if (type === 'speed') player.stats.speed += 1.5;
                if (type === 'power') player.stats.power += 5;
                if (type === 'pierce') player.stats.pierce++;
                if (type === 'speed') player.stats.fireRate = Math.max(100, 350 - (player.upgrades.speed.level * 15));

                updateHUD();
            }
        }

        // --- Quiz System ---
        function showQuiz() {
            const quizEl = document.getElementById('quizScreen');
            quizEl.classList.remove('hidden');
            
            // Randomly select a question
            const qIndex = Math.floor(Math.random() * quizData.length);
            const currentQ = quizData[qIndex];

            const baseReward = 200;
            const reward = Math.floor(baseReward * Math.pow(1.35, player.wave - 1));
            document.getElementById('quizRewardVal').innerText = reward;
            
            // Allow HTML for line breaks
            document.getElementById('questionText').innerHTML = currentQ.q;
            
            const optsContainer = document.getElementById('answerOptions');
            optsContainer.innerHTML = '';
            
            // Display options
            currentQ.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'quiz-btn shadow-md';
                btn.innerText = opt;
                // Check if this option index matches answer index
                const isCorrect = (index === currentQ.ans);
                btn.onclick = () => answerQuiz(isCorrect, reward);
                optsContainer.appendChild(btn);
            });
        }

        function answerQuiz(correct, reward) {
            const quizEl = document.getElementById('quizScreen');
            if (correct) {
                player.gold += reward;
                updateHUD();
            } else {
                // Optional: Penalty or just no reward
            }
            
            quizEl.classList.add('hidden');
            
            if (player.wave >= MAX_WAVE) {
                victory();
            } else {
                nextWave();
            }
        }

        function nextWave() {
            player.wave++;
            startWave();
            
            if (animationId) cancelAnimationFrame(animationId);
            lastTime = performance.now();
            animationId = requestAnimationFrame(loop);
        }

    </script>
</body>
</html>